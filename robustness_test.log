2025-07-04 21:55:20,704 - INFO - Checking for ffmpeg...
2025-07-04 21:55:20,704 - INFO - Generating test video: C:\Dev\editor-MVP\backend\robustness_test_input.mp4...
2025-07-04 21:55:21,480 - INFO - Test video generated successfully.
2025-07-04 21:55:21,480 - INFO - --- STEP 1: UPLOADING VIDEO ---
2025-07-04 21:55:22,653 - INFO - Upload successful. Session ID: 5c00fb5a-b596-4cf1-ae67-4c33ff8a4883
2025-07-04 21:55:22,653 - INFO - --- STEP 2: SENDING PROMPT 'Make the video black and white.' ---
2025-07-04 21:55:39,580 - INFO - Step 2 SUCCEEDED. Response: {'status': 'success', 'output_url': '/static/5c00fb5a-b596-4cf1-ae67-4c33ff8a4883/preview.mp4', 'steps_taken': 2, 'log_file': 'run_edit_1.log'}
2025-07-04 21:55:40,583 - INFO - --- STEP 3: SENDING PROMPT 'Now, speed the footage up by 2x.' ---
2025-07-04 21:56:10,587 - INFO - Step 3 SUCCEEDED. Response: {'status': 'success', 'output_url': '/static/5c00fb5a-b596-4cf1-ae67-4c33ff8a4883/preview.mp4', 'steps_taken': 2, 'log_file': 'run_edit_2.log'}
2025-07-04 21:56:11,590 - INFO - --- STEP 4: SENDING PROMPT 'Make the video smell like coffee and roses.' ---
2025-07-04 21:56:22,847 - ERROR - Step 4 FAILED with HTTP Status Code: 500
2025-07-04 21:56:22,847 - ERROR - Response Body: {"status":"error","error":"Failed during step 'planning': list index out of range","log_file":"run_edit_3.log"}
2025-07-04 21:56:22,847 - INFO - --- STEP 5: SENDING PROMPT 'Crop the video to a square aspect ratio, focusing on the center.' ---
2025-07-04 21:56:41,361 - INFO - Step 5 SUCCEEDED. Response: {'status': 'success', 'output_url': '/static/5c00fb5a-b596-4cf1-ae67-4c33ff8a4883/preview.mp4', 'steps_taken': 2, 'log_file': 'run_edit_3.log'}
2025-07-04 21:56:42,372 - INFO - --- STEP 6: SENDING PROMPT 'Trim the result to the first 4 seconds of its new duration.' ---
2025-07-04 21:58:00,639 - ERROR - Step 6 FAILED with HTTP Status Code: 500
2025-07-04 21:58:00,654 - ERROR - Response Body: {"status":"error","error":"Failed during step 'Trim the input video to keep only the segment from the beginning (0 seconds) to 4 seconds.': Failed to generate a valid script for task 'Trim the input video to keep only the segment from the beginning (0 seconds) to 4 seconds.' after 3 retries.\nLast errors: {'Candidate 1': {'error': '[SandboxError] Script ran successfully but did not create an output video file.', 'code': 'import subprocess\\n\\ndef run_ffmpeg_command(inputs, outputs):\\n    input_video_path = inputs[\\'initial_video\\']\\n    output_video_path = outputs[\\'final_video\\']\\n    trim_duration = 4 # seconds\\n\\n    # Construct the FFmpeg command to trim the video from the beginning.\\n    # -t (duration) placed before -i (input) tells FFmpeg to process only the first\\n    # \\'trim_duration\\' seconds of the input file.\\n    # -c copy ensures a fast and lossless trim by stream copying video and audio,\\n    # avoiding re-encoding. This is suitable for trimming from the beginning\\n    # or at keyframes.\\n    command = [\\n        \\'ffmpeg\\',\\n        \\'-t\\', str(trim_duration),  # Specify the duration to process from the input\\n        \\'-i\\', input_video_path,    # Input video file\\n        \\'-c\\', \\'copy\\',              # Stream copy video and audio to avoid re-encoding\\n        output_video_path          # Output video file\\n    ]\\n\\n    try:\\n        # Execute the FFmpeg command using subprocess.run\\n        # check=True: Raises CalledProcessError if the command returns a non-zero exit code.\\n        # capture_output=True: Captures stdout and stderr.\\n        # text=True: Decodes stdout and stderr as text.\\n        subprocess.run(command, check=True, capture_output=True, text=True)\\n    except subprocess.CalledProcessError as e:\\n        # If FFmpeg command fails (returns a non-zero exit code),\\n        # raise a RuntimeError with the command\\'s stderr output for debugging.\\n        raise RuntimeError(f\"FFmpeg command failed with error: {e.stderr}\\\\nCommand: {\\' \\'.join(e.cmd)}\") from e\\n    except FileNotFoundError:\\n        # If the \\'ffmpeg\\' executable is not found in the system\\'s PATH.\\n        raise RuntimeError(\"FFmpeg not found. Please ensure FFmpeg is installed and in your system\\'s PATH.\")\\n    except Exception as e:\\n        # Catch any other unexpected errors that might occur during subprocess execution.\\n        raise RuntimeError(f\"An unexpected error occurred during FFmpeg execution: {e}\")'}, 'Candidate 2': {'error': '[SandboxError] Script ran successfully but did not create an output video file.', 'code': 'import subprocess\\n\\ndef run_ffmpeg_command(inputs, outputs):\\n    input_video_path = inputs[\\'initial_video\\']\\n    output_video_path = outputs[\\'final_video\\']\\n    trim_duration = 4\\n\\n    command = [\\n        \\'ffmpeg\\',\\n        \\'-i\\', input_video_path,\\n        \\'-t\\', str(trim_duration),\\n        \\'-c\\', \\'copy\\',\\n        \\'-y\\',\\n        output_video_path\\n    ]\\n\\n    try:\\n        subprocess.run(command, check=True, capture_output=True, text=True)\\n    except subprocess.CalledProcessError as e:\\n        raise RuntimeError(f\"FFmpeg command failed with error: {e.stderr}\") from e\\n    except FileNotFoundError:\\n        raise RuntimeError(\"FFmpeg not found. Please ensure FFmpeg is installed and in your PATH.\")\\n    except Exception as e:\\n        raise RuntimeError(f\"An unexpected error occurred: {e}\")'}}","log_file":"run_edit_4.log"}
2025-07-04 21:58:00,654 - INFO - --- STEP 7: SENDING PROMPT 'Finally, add the text 'E2E ROBUSTNESS TEST' in the center of the video.' ---
2025-07-04 21:58:23,021 - INFO - Step 7 SUCCEEDED. Response: {'status': 'success', 'output_url': '/static/5c00fb5a-b596-4cf1-ae67-4c33ff8a4883/preview.mp4', 'steps_taken': 2, 'log_file': 'run_edit_4.log'}
2025-07-04 21:58:24,027 - INFO - ======================================
2025-07-04 21:58:24,045 - INFO - ======================================
2025-07-04 21:58:24,045 - INFO - --- CLEANUP ---
2025-07-04 21:58:24,054 - INFO - Removed session directory: C:\Dev\editor-MVP\backend\sessions\5c00fb5a-b596-4cf1-ae67-4c33ff8a4883
2025-07-04 21:58:24,054 - INFO - Removed test video: C:\Dev\editor-MVP\backend\robustness_test_input.mp4
